# üõ† Service Monitoring API (FastAPI)

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π API –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏–π, –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (SLA).

## üöÄ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
*   **–Ø–∑—ã–∫:** Python 3.10+
*   **–§—Ä–µ–π–º–≤–æ—Ä–∫:** FastAPI (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
*   **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (–æ—Å–Ω–æ–≤–Ω–∞—è)
*   **ORM:** SQLAlchemy 2.0 (Async)
*   **–í–∞–ª–∏–¥–∞—Ü–∏—è:** Pydantic v2
*   **–û–∫—Ä—É–∂–µ–Ω–∏–µ:** Docker + Docker Compose

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```text
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/                # –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è (API Routes)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ v1/             # –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ API
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ api.py      # –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ endpoints/  # –õ–æ–≥–∏–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ (services.py)
‚îÇ   ‚îú‚îÄ‚îÄ core/               # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (config.py)
‚îÇ   ‚îú‚îÄ‚îÄ db/                 # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å (session.py, base.py)
‚îÇ   ‚îú‚îÄ‚îÄ models/             # –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQLAlchemy)
‚îÇ   ‚îú‚îÄ‚îÄ schemas/            # –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ö–µ–º JSON (Pydantic)
‚îÇ   ‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Ä–∞—Å—á–µ—Ç SLA)
‚îÇ   ‚îî‚îÄ‚îÄ main.py             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ FastAPI app)
‚îú‚îÄ‚îÄ .env                    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø–∞—Ä–æ–ª–∏, URL –±–∞–∑—ã)
‚îú‚îÄ‚îÄ docker-compose.yml      # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è PostgreSQL
‚îú‚îÄ‚îÄ init_db.py              # –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–±–ª–∏—Ü
‚îî‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
```

---

## üóÑ –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü:

1.  **Service (–°–µ—Ä–≤–∏—Å—ã)**:
    *   `id`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.
    *   `name`: –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Payment API").
2.  **ServiceState (–ò—Å—Ç–æ—Ä–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π)**:
    *   `id`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä.
    *   `service_id`: –°–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π —Å–µ—Ä–≤–∏—Å–æ–≤ (Foreign Key).
    *   `status`: –û–¥–Ω–æ –∏–∑ –∑–Ω–∞—á–µ–Ω–∏–π: `working`, `not_working`, `unstable`.
    *   `description`: –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).
    *   `created_at`: –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).

**–°–≤—è–∑—å:** –û–¥–∏–Ω —Å–µ—Ä–≤–∏—Å –∏–º–µ–µ—Ç –º–Ω–æ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π (One-to-Many).

---

## üì° API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
*   **POST** `/api/v1/services/states`
*   **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:** –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –∏ –µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å–∞ —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º –µ—â–µ –Ω–µ—Ç, –æ–Ω —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ù–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∏—Å—Ç–æ—Ä–∏—é.

### 2. –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
*   **GET** `/api/v1/services/`
*   **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:** –í—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ –∏—Ö **–ø–æ—Å–ª–µ–¥–Ω–µ–µ (–∞–∫—Ç—É–∞–ª—å–Ω–æ–µ)** —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

### 3. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
*   **GET** `/api/v1/services/{name}/history`
*   **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:** –í—ã–¥–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ –µ–≥–æ –∏–º–µ–Ω–∏, –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º.

### 4. –†–∞—Å—á–µ—Ç SLA (–î–æ–ø. –∑–∞–¥–∞–Ω–∏–µ)
*   **GET** `/api/v1/services/{name}/sla?start_date=...&end_date=...`
*   **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:** –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.
*   **–õ–æ–≥–∏–∫–∞:** –ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –º–µ–∂–¥—É –∑–∞–ø–∏—Å—è–º–∏. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –±—ã–ª `not_working`, —ç—Ç–æ –≤—Ä–µ–º—è —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–µ–º.
*   **–§–æ—Ä–º—É–ª–∞:** `(–í—Å–µ–≥–æ_–≤—Ä–µ–º–µ–Ω–∏ - –í—Ä–µ–º—è_–ø—Ä–æ—Å—Ç–æ—è) / –í—Å–µ–≥–æ_–≤—Ä–µ–º–µ–Ω–∏ * 100` (—Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ 3 –∑–Ω–∞–∫–æ–≤).

–î–ª—è –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Swagger 

---

## ‚öôÔ∏è –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ SLA (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
–†–∞—Å—á–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ `app/services/sla_calculator.py`. 
–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
1.  **–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è:** –í—Ä–µ–º—è –º–µ–∂–¥—É `start_date` –∏ `end_date` —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Ç—Ä–µ–∑–∫–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –º–æ–º–µ–Ω—Ç–∞–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞.
2.  **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥—Ä–∞–Ω–∏—Ü:** –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—á–∞–ª–æ—Å—å –¥–æ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–∏–æ–¥–∞ (`start_date`), —Ä–∞—Å—á–µ—Ç –Ω–∞—á–Ω–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –æ—Ç `start_date`.
3.  **–°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°—É–º–º–∏—Ä—É–µ—Ç—Å—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –æ—Ç—Ä–µ–∑–∫–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `not_working`.

---

## üõ† –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
git clone <url_–ø—Ä–æ–µ–∫—Ç–∞>
cd service_monitor
python -m venv venv
source venv/bin/activate  # –î–ª—è Windows: venv\Scripts\activate
pip install -r requirements.txt
```

### 2. –ó–∞–ø—É—Å–∫ PostgreSQL
```bash
docker-compose up -d
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
python init_db.py
```

### 4. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
uvicorn app.main:app --reload
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: **http://127.0.0.1:8000/docs**

---

## üìù –†–∞–∑–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

*   **Dependency Injection (`Depends`)**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ FastAPI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
*   **Async/Await**: –í–µ—Å—å –≤–≤–æ–¥-–≤—ã–≤–æ–¥ (–∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ—Ç–Ω–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.
*   **Pydantic –°—Ö–µ–º—ã**: –û—Ç–¥–µ–ª–µ–Ω—ã –æ—Ç –º–æ–¥–µ–ª–µ–π –ë–î. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –º—ã –Ω–µ –æ—Ç–¥–∞–¥–∏–º –∫–ª–∏–µ–Ω—Ç—É –ª–∏—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä–æ–ª–∏ –∏–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ ID) –∏ —Å—Ç—Ä–æ–≥–æ –ø—Ä–æ–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Ö–æ–¥—è—â–∏–π JSON.
*   **Selectinload**: –ú–µ—Ç–æ–¥ SQLAlchemy –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã N+1. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–∏—Å –∏ –≤—Å—é –µ–≥–æ –∏—Å—Ç–æ—Ä–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –∑–∞ –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ –¥–µ—Å—è—Ç–∫–æ–≤.

---
